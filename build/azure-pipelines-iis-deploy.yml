trigger: none

pr: none

variables:
  - name: BuildConfiguration
    value: 'Release'
  - name: BuildPlatform
    value: 'AnyCPU'
  - name: Solution
    value: 'NetFrameworkDeployIIS/NetFrameworkDeployIIS.csproj'
  - name: IISSiteName
    value: 'iisdeploy'
  - name: IISPhysicalPath
    value: '%SystemDrive%\inetpub\wwwroot\$(IISSiteName)'
  - name: ConnectionStrings.DefaultConnection
    value: 'Server=localhost,1433;Database=MANGO_PROD;User Id=sa;Password=x2yiJt!Fs;TrustServerCertificate=true;'


stages:
  - stage: 'Build_Test_Package'
    displayName: 'Build/Test/Package'
    jobs:
      - job: 'Build'
        displayName: 'Build and test'
        pool:
          vmImage: 'windows-latest'
        steps:
          - template: templates/azure-pipelines-build-template.yml
            
  - stage: 'dev'
    displayName: 'WebApp Deploy DEV'
    dependsOn: Build_Test_Package
    condition: succeeded('Build_Test_Package')
    jobs:
      - deployment: deploymentJob
        displayName: Deployment Job
        environment:
          name: dev
          resourceType: VirtualMachine

        strategy:
          runOnce:
            deploy:
              steps:
                - template: templates/azure-pipelines-webapp-deploy-template.yml